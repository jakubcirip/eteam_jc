<div *ngIf="data !== null">
  <div class="page-hero page-container">
    <div class="padding d-flex">
      <div class="page-title">
        <h2 class="text-md text-highlight">
          <svg
            style="cursor: pointer;"
            (click)="goBack()"
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="#f54394"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="feather feather-chevrons-left mx-2"
          >
            <polyline points="11 17 6 12 11 7"></polyline>
            <polyline points="18 17 13 12 18 7"></polyline>
          </svg>
          Interview - {{ data.basicData.name }}
        </h2>
        <small style="margin-left: 45px;" class="text-muted"
          >Interview Editor</small
        >
      </div>
    </div>
  </div>
  <div class="page-content page-container" id="page-content">
    <div class="padding">
      <div class="card">
        <div class="card-header">
          <strong> Basic Information </strong>
        </div>
        <div class="card-body">
          <div class="input-group mb-3">
            <div class="input-group-prepend">
              <span class="input-group-text" id="basic-addon3">Name</span>
            </div>
            <input
              type="text"
              class="form-control"
              aria-describedby="basic-addon3"
              disabled="disabled"
              [value]="data.basicData.name"
            />

            <div class="input-group-append">
              <span class="input-group-text" id="basic-addon3">
                <svg
                  (click)="editInt()"
                  style="cursor: pointer;"
                  xmlns="http://www.w3.org/2000/svg"
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="#f4c414"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="feather feather-edit"
                >
                  <path
                    d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"
                  ></path>
                  <path
                    d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"
                  ></path>
                </svg>
              </span>
            </div>
          </div>

          <div class="input-group mb-3">
            <div class="input-group-prepend">
              <span class="input-group-text" id="basic-addon3">Color</span>
            </div>
            <input
              type="text"
              class="form-control"
              aria-describedby="basic-addon3"
              [value]="data.basicData.color"
              disabled="disabled"
            />
            <div class="input-group-append">
              <span class="input-group-text" id="basic-addon3">
                <svg
                  (click)="editColor()"
                  style="cursor: pointer;"
                  xmlns="http://www.w3.org/2000/svg"
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="#f4c414"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="feather feather-edit"
                >
                  <path
                    d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"
                  ></path>
                  <path
                    d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"
                  ></path>
                </svg>
              </span>
            </div>
          </div>

          <div class="input-group mb-3">
            <div class="input-group-prepend">
              <span class="input-group-text" id="basic-addon3"
                >Background color</span
              >
            </div>
            <input
              type="text"
              class="form-control"
              aria-describedby="basic-addon3"
              [value]="this.data.basicData.dark ? 'Dark theme' : 'Light theme'"
              disabled="disabled"
            />
            <div class="input-group-append">
              <span
                style="cursor: pointer;"
                class="input-group-text"
                id="basic-addon3"
                (click)="onSwitchBackgroundColor()"
              >
                <b class="text-warning">
                  SWITCH TO {{ this.data.basicData.dark ? 'LIGHT' : 'DARK' }}
                </b>
              </span>
            </div>
          </div>

          <div class="input-group mb-3">
            <div class="input-group-prepend">
              <span class="input-group-text" id="basic-addon3">Image</span>
            </div>
            <input
              type="text"
              class="form-control"
              aria-describedby="basic-addon3"
              [value]="shortImageData(data.basicData.image)"
              disabled="disabled"
            />
            <div class="input-group-append">
              <span class="input-group-text" id="basic-addon3">
                <a (click)="openImagePreview()" style="cursor: pointer;">
                  <svg
                    style="cursor: pointer;"
                    xmlns="http://www.w3.org/2000/svg"
                    width="18"
                    height="18"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="#31c971"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    class="feather feather-external-link"
                  >
                    <path
                      d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"
                    ></path>
                    <polyline points="15 3 21 3 21 9"></polyline>
                    <line x1="10" y1="14" x2="21" y2="3"></line>
                  </svg>
                </a>
              </span>
              <span class="input-group-text" id="basic-addon3">
                <svg
                  (click)="editImage()"
                  style="cursor: pointer;"
                  xmlns="http://www.w3.org/2000/svg"
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="#f4c414"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="feather feather-edit"
                >
                  <path
                    d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"
                  ></path>
                  <path
                    d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"
                  ></path>
                </svg>
              </span>
            </div>
          </div>

          <hr />

          <div class="input-group mb-3">
            <div class="input-group-prepend">
              <span class="input-group-text" id="basic-addon3"
                >Interview Tag</span
              >
            </div>
            <input
              type="text"
              class="form-control"
              aria-describedby="basic-addon3"
              disabled="disabled"
              [value]="data.basicData.tag"
            />
          </div>
          <div class="input-group mb-3">
            <div class="input-group-prepend">
              <span class="input-group-text" id="basic-addon3">State</span>
            </div>
            <input
              type="text"
              class="form-control"
              aria-describedby="basic-addon3"
              disabled="disabled"
              [value]="data.basicData.state"
            />
          </div>
        </div>
      </div>

      <div class="card" [ngClass]="[getColor('pos-all')]">
        <div class="card-header">
          <strong>
            <span
              [ngClass]="[getColor('pos-all')]"
              class="badge badge-circle text-success"
            ></span>
            Job Position Settings</strong
          >
        </div>
        <div class="card-body">
          <div class="input-group mb-3">
            <div class="input-group-prepend">
              <span class="input-group-text" id="basic-addon3">
                <span
                  class="badge badge-circle text-success"
                  [ngClass]="[getColor('pos-pos')]"
                ></span
                >Job Position</span
              >
            </div>
            <select
              class="form-control no-radius"
              (change)="onPosChange(+$event.target.value)"
            >
              <option [selected]="-1 === data.basicData.posId" value="-1"
                >Select Job Position</option
              >
              <option
                *ngFor="let o of data.settings.jobs.positions"
                [value]="o.id"
                [selected]="o.id === data.basicData.posId"
              >
                {{ o.name }}
              </option>
            </select>
          </div>

          <div class="input-group mb-3">
            <div class="input-group-prepend">
              <span class="input-group-text" id="basic-addon3"
                ><span
                  class="badge badge-circle text-success"
                  [ngClass]="[getColor('pos-form')]"
                ></span
                >Job Position Formular</span
              >
            </div>
            <select
              class="form-control no-radius"
              (change)="onFormChange(+$event.target.value)"
            >
              <option
                *ngIf="formData && formData.length > 0"
                [selected]="-1 === data.basicData.formId"
                value="-1"
                >Select Position Formular</option
              >
              <option
                *ngFor="let o of formData"
                [value]="o.id"
                [selected]="o.id === data.basicData.formId"
              >
                {{ o.name }}
              </option>
            </select>
          </div>
        </div>
      </div>

      <div
        *ngFor="let type of data.types"
        class="card"
        [ngClass]="[getColor('advanced-all', type)]"
      >
        <div class="card-header">
          <strong>
            <span
              class="badge badge-circle text-success"
              [ngClass]="[getColor('advanced-all', type)]"
            ></span>
            {{ type.title }}
          </strong>
        </div>
        <div class="card-body">
          <div *ngIf="type.staticDate === true" class="input-group mb-3">
            <div class="input-group-prepend">
              <span class="input-group-text" id="basic-addon3">
                <span
                  [ngClass]="[getColor('advanced-date', type)]"
                  class="badge badge-circle text-success"
                  style="margin-right: 10px;"
                ></span
                >Date</span
              >
            </div>

            <input
              (dateTimeChange)="onDateChange(type, $event)"
              [value]="getDate(type.name)"
              style="cursor: pointer; opacity: 1; color: #b9c0d3;"
              [owlDateTimeTrigger]="dt"
              [owlDateTime]="dt"
              type="text"
              class="form-control"
              aria-describedby="basic-addon3"
              disabled="disabled"
            />

            <owl-date-time #dt></owl-date-time>
          </div>

          <div class="input-group mb-3">
            <div class="input-group-prepend">
              <span class="input-group-text"
                ><span
                  [ngClass]="[getColor('advanced-email', type)]"
                  class="badge badge-circle text-success"
                  style="margin-right: 10px;"
                ></span
                >Email</span
              >
            </div>
            <select
              (change)="onEmailChange(type, $event)"
              style="cursor: pointer;"
              class="form-control no-radius"
            >
              <option [selected]="isSelected(-1, type.name)" value="-1"
                >Select Email</option
              >
              <option
                [selected]="isSelected(mail.id, type.name)"
                [value]="mail.id"
                *ngFor="let mail of getMails(type.name)"
              >
                {{ mail.name }}
              </option>
            </select>
          </div>
        </div>
      </div>

      <div class="card" [ngClass]="[getColor('prelog')]">
        <div class="card-header">
          <strong>
            <span
              [ngClass]="[getColor('prelog')]"
              class="badge badge-circle text-success"
            ></span>
            HR Prelog for candidate</strong
          >
        </div>
        <div class="card-body">
          <div class="form-group">
            <textarea #prelogArea class="form-control" rows="10">{{
              data.basicData.prelog
            }}</textarea>
            <button
              style="margin-top: 15px;"
              (click)="onSavePrelog(prelogArea)"
              type="button"
              class="btn btn-primary"
            >
              Save prelog
            </button>
          </div>
        </div>
      </div>

      <div class="container-fluid">
        <div class="row">
          <div class="col-12 d-flex" style="padding: 0;">
            <div
              class="card flex"
              data-sr-id="3"
              style="
                visibility: visible;
                transform: none;
                opacity: 1;
                transition: none 0s ease 0s;
              "
            >
              <div class="card-body">
                <small style="font-size: 16px;"
                  >Interview setup completition percentage:
                  <strong class="text-primary" style="font-size: 20px;">
                    {{
                      (totalFinished * 100) / totalSetupSteps | number: '1.0-0'
                    }}%</strong
                  >

                  <strong style="margin-left: 15px; font-size: 16px;">
                    {{ totalFinished }}/{{ totalSetupSteps }}
                  </strong>
                </small>
                <div class="progress my-3 circle" style="height: 6px;">
                  <div
                    class="progress-bar circle gd-primary"
                    data-toggle="tooltip"
                    title=""
                    [ngStyle]="{
                      width:
                        Math.round((totalFinished * 100) / totalSetupSteps) +
                        '%'
                    }"
                    [attr.data-original-title]="
                      Math.round((totalFinished * 100) / totalSetupSteps) + '%'
                    "
                  ></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div
  id="backgrounds-modal"
  class="modal fade"
  tabindex="-1"
  role="dialog"
  *ngIf="images.length > 0"
>
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Select Image</h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>
          These images are provided by Unsplash and can be used for free. You
          can find information about authors of these ptohos
          <a [href]="apiUrl + '/public/bulksplash-credits.json'" target="_blank"
            >here</a
          >
        </p>

        <div class="row">
          <div
            class="col-md-3"
            style="margin-bottom: 20px;"
            *ngFor="let img of images | arrayInfexFilter: maxImages"
          >
            <div
              style="
                width: 100%;
                height: 255px;
                background-size: cover;
                background-position: center;
                position: relative;
              "
              [ngStyle]="{ backgroundImage: 'url(' + img.urlSmall + ')' }"
            >
              <div
                (click)="onSelectBackgroundImage(img)"
                class="btn btn-white"
                style="
                  background-color: white;
                  cursor: pointer;
                  border-radius: 5px;
                  padding: 10px;
                  position: absolute;
                  bottom: 5px;
                  width: calc(100% - 30px);
                  left: 15px;
                  text-align: center;
                "
              >
                <span class="text-primary">Select</span>
              </div>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-md-12">
            <div class="btn btn-block btn-primary" (click)="loadMoreImages()">
              Load more images
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <small class="text-primary" style="font-weight: bold;">
          Changes apply automatically
        </small>
        <button type="button" class="btn btn-light" data-dismiss="modal">
          Close
        </button>
      </div>
    </div>
  </div>
</div>

<div
  id="preview-background-modal"
  class="modal fade"
  tabindex="-1"
  role="dialog"
  *ngIf="data"
>
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Background Preview</h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <img
          [src]="generatePreviewUrl()"
          alt="Background preview"
          style="width: 100%;"
        />
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-light" data-dismiss="modal">
          Close
        </button>
      </div>
    </div>
  </div>
</div>
